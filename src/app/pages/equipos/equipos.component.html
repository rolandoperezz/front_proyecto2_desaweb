<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>


<p-table
  #dt
  [value]="equipos"
  dataKey="id"
  [loading]="loading"
  [paginator]="true"
  [rows]="10"
  [rowsPerPageOptions]="[10,25,50]"
  [globalFilterFields]="['nombre','ciudad']"
  [tableStyle]="{ 'min-width': '60rem' }"
  responsiveLayout="scroll"
  class="shadow-1 border-round-xl"
>
 <ng-template pTemplate="caption">
                        <div class="flex">
                            <span class="p-input-icon-left ml-auto">
                                <i class="pi pi-search"></i>
                                <input pInputText type="text" (input)="dt.filterGlobal($any($event.target).value, 'contains')"  placeholder="Buscar" />
                            </span>
                                <button pButton type="button" label="Limpiar" icon="pi pi-filter-slash" class="p-button-text"
              (click)="dt.clear()"></button>
      <button pButton type="button" label="Nuevo" icon="pi pi-plus" (click)="openNew()"></button>
                        </div>
                      
</ng-template>

   

  <ng-template pTemplate="header">
    <tr>
      <th style="width:90px">Logo</th>
      <th pSortableColumn="nombre">Nombre <p-sortIcon field="nombre"></p-sortIcon></th>
      <th pSortableColumn="ciudad">Ciudad <p-sortIcon field="ciudad"></p-sortIcon></th>
      <th style="width:160px" class="text-center">Acciones</th>
    </tr>
    <tr>
      <th></th>
      <th>
        <p-columnFilter
          type="text"
          field="nombre"
          display="menu"
          placeholder="Filtrar nombre"
          ariaLabel="Filtrar nombre">
        </p-columnFilter>
      </th>
      <th>
        <p-columnFilter
          type="text"
          field="ciudad"
          display="menu"
          placeholder="Filtrar ciudad"
          ariaLabel="Filtrar ciudad">
        </p-columnFilter>
      </th>
      <th></th>
    </tr>
  </ng-template>

  <!-- Cuerpo -->
  <ng-template pTemplate="body" let-row>
    <tr>
      <td>
        <img [src]="row.logoUrl" alt="logo" class="logo" />
      </td>
      <td>{{ row.nombre }}</td>
      <td>{{ row.ciudad }}</td>
      <td class="text-center">
        <button pButton icon="pi pi-pencil" class="p-button-text p-button-sm" (click)="openEdit(row)"></button>
        <button pButton icon="pi pi-trash" class="p-button-text p-button-danger p-button-sm" (click)="askDelete(row)"></button>
      </td>
    </tr>
  </ng-template>

  <ng-template pTemplate="emptymessage">
    <tr><td colspan="4" class="text-center text-600">Sin resultados</td></tr>
  </ng-template>
</p-table>



<p-dialog
  [(visible)]="dialogVisible"
  [modal]="true"
  [draggable]="false"
  [style]="{width:'520px', maxWidth:'95vw'}"
  [header]="isEdit ? 'Editar equipo' : 'Nuevo equipo'"
>
  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="p-fluid" novalidate>
    <div class="field">
      <label class="mb-2 block">Nombre</label>
      <input
        pInputText
        formControlName="nombre"
        placeholder="Nombre del equipo"
        [class.p-invalid]="submitted && form.get('nombre')?.invalid"
      />
      <small class="p-error" *ngIf="submitted && form.get('nombre')?.errors">Requerido</small>
    </div>

    <div class="field">
      <label class="mb-2 block">Ciudad</label>
      <input
        pInputText
        formControlName="ciudad"
        placeholder="Ciudad"
        [class.p-invalid]="submitted && form.get('ciudad')?.invalid"
      />
      <small class="p-error" *ngIf="submitted && form.get('ciudad')?.errors">Requerido</small>
    </div>

    <div class="field">
      <label class="mb-2 block">Logo (URL)</label>
      <div class="p-inputgroup">
        <span class="p-inputgroup-addon"><i class="pi pi-image"></i></span>
        <input
          pInputText
          formControlName="logoUrl"
          placeholder="https://..."
          [class.p-invalid]="submitted && form.get('logoUrl')?.invalid"
        />
      </div>
      <small class="p-error" *ngIf="submitted && form.get('logoUrl')?.errors">Requerido</small>

      <div class="mt-2 flex align-items-center gap-3">
        <img [src]="logoPreview" class="logo-preview" alt="preview" />
        <small class="text-600">Previsualizaci√≥n</small>
      </div>
    </div>

    <div class="flex justify-content-end gap-2 mt-3">
      <button pButton type="button" label="Cancelar" class="p-button-text" (click)="dialogVisible=false"></button>
      <button pButton type="submit" label="Guardar" [disabled]="loading"></button>
    </div>
  </form>
</p-dialog>
